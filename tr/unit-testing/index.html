


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Bu sayfada unit testlerin yazılış amacı, uygulanış biçimleri, test için uygun tasarım desenleri ve test yazarken önüne geçilebilecek hatalar anlatılmaktadır.">
      
      
        <link rel="canonical" href="https://mgurdal.github.io/go-tutorial/tr/unit-testing/">
      
      
        <meta name="author" content="Mehmet Gürdal">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.0.1">
    
    
      
        <title>Unit Testing - Go Tutorial</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.c3000690.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../assets/css/extra.css">
    
    
      
        
<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-163254669-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unit-testing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://mgurdal.github.io/go-tutorial" title="Go Tutorial" class="md-header-nav__button md-logo" aria-label="Go Tutorial">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Go Tutorial
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Unit Testing
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://mgurdal.github.io/go-tutorial" title="Go Tutorial" class="md-nav__button md-logo" aria-label="Go Tutorial">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    Go Tutorial
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../data-structures/" title="Data Structures" class="md-nav__link">
      Data Structures
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../concurrency/" title="Concurrency" class="md-nav__link">
      Concurrency
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#giris" class="md-nav__link">
    Giriş
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-etmek" class="md-nav__link">
    Test etmek
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yeni-ozellikler-eklemek" class="md-nav__link">
    Yeni Özellikler Eklemek
  </a>
  
    <nav class="md-nav" aria-label="Yeni Özellikler Eklemek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gelistirme-disiplini" class="md-nav__link">
    Geliştirme Disiplini
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daha-fazla-ozellik" class="md-nav__link">
    Daha fazla özellik
  </a>
  
    <nav class="md-nav" aria-label="Daha fazla özellik">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#yeni-dil" class="md-nav__link">
    Yeni dil
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-example" class="md-nav__link">
    Real World Example
  </a>
  
    <nav class="md-nav" aria-label="Real World Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mocking" class="md-nav__link">
    Mocking
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-test" class="md-nav__link">
    Table Test
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anti-patternler" class="md-nav__link">
    Anti-Patternler
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="unit-testing">Unit Testing<a class="headerlink" href="#unit-testing" title="Permanent link">&para;</a></h1>
<blockquote>
<p>Code without tests is broken as designed.<br />
<a href="https://jacobian.org/">Jacob Kaplan-Moss</a></p>
</blockquote>
<h2 id="giris">Giriş<a class="headerlink" href="#giris" title="Permanent link">&para;</a></h2>
<p>Unit testing, projedeki fonksiyonel her bir birimin tüm davranışlarının test edildiği yazılım test yöntemidir. Biraz daha açmak gerekirse; bir birim, testi mümkün olan en küçük yazılım bileşenidir ve çoğunlukla tek bir iş, yapmakla görevlidir. </p>
<p>Unit testin amacı, programın küçük bölümlere ayırıp, tüm bölümlerin beklenildiği gibi çalıştığınından emin olmaktır.</p>
<p>Unit testleri yazılan bir projede:</p>
<ul>
<li>Projeye yeni eklenen kodun, istenildiği gibi çalışıp, çalışmadığını kontrol edilebilir.</li>
<li>Varolan kod düzenlendiğinde, projenin davranışının beklenmedik şekilde değiştirmediğinden emin olunur.</li>
<li>Yazılımcı, projeye eklenecek karmaşık özellikleri küçük, anlaşılır parçalara bölmesine dolayısıyla işe yarar minimum fonksiyonelliğe hızlıca erişip gereksiz optimizasyondan kaçınmasına yardımcı olur.</li>
<li>Ekibe yeni katılan yazılımcılar, testleri döküman olarak kullanabilir.</li>
</ul>
<blockquote>
<p>Testlerin bir projedeki bütün hataları çözmesi beklenmemelidir. Projelerde her zaman hata vardır. Bu hatalar, test edilmeyen bir durumdan, yanlış test etmekten veya testlerin kontrol edemeyeceği 3. parti kütüphanelerden, APIlerden, konfigürasyon sorunlarınlarında kaynaklı olabilir.</p>
</blockquote>
<h2 id="test-etmek">Test etmek<a class="headerlink" href="#test-etmek" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;fmt&quot;</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, world&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>Yukarıdaki kodu test etmeden önce yan etkilerden arındırmalıyız. Buradaki side-effect <code>Println</code> fonksiyonu.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;fmt&quot;</span>

<span class="kd">func</span> <span class="nx">Hello</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;Hello, world&quot;</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">Hello</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div>


<p>Şimdi <code>Hello</code> fonksiyonunu için test yazalım.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">TestHello</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">()</span>
    <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Hello, world&quot;</span>

    <span class="k">if</span> <span class="nx">got</span> <span class="o">!=</span> <span class="nx">want</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>Go testlerini çalıştırmak için ek araçlara veya frameworklere ihtiyacımız yok. Sadece <code>go test</code> komutu ile yazdığımız testleri çalıştırabiliriz.</p>
<p><img alt="" src=".gitbook/assets/image%20%283%29.png" /></p>
<p>Test yazmanın belirli kurallar çerçevesinde fonksiyonlar yazmaktan farkı yoktur. Bu fonksiyonların test olarak kabul edilmesi için:</p>
<ul>
<li><code>xxx_test.go</code> gibi bir dosya içinde olması</li>
<li>Fonksiyon isminin <code>Test</code> ile başlaması</li>
<li>Fonksiyonun yalnızca <code>t *testing.T</code> parametresini alması gerekir.</li>
</ul>
<h2 id="yeni-ozellikler-eklemek"><strong>Yeni Özellikler Eklemek</strong><a class="headerlink" href="#yeni-ozellikler-eklemek" title="Permanent link">&para;</a></h2>
<p><img alt="Source: https://openclassrooms.com/en/courses/4554386-enhance-an-existing-app-using-test-driven-development/5095731-understand-the-red-green-refactor-methodology" src=".gitbook/assets/image%20%2812%29.png" /></p>
<p>Test başarılı bir şekilde çalıştığına göre artık uygulamaya yeni özellikler ekleyebiliriz.</p>
<p>Şimdi Hello fonksiyonu parametre olarak bir isim alsın ve o ismi selamlasın.<br />
Bunun için öncellikle kodun yeni halini test eden ve başarısız olan bir test yazacağız.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">TestHello</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;Mehmet&quot;</span><span class="p">)</span>
    <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Hello, Mehmet&quot;</span>

    <span class="k">if</span> <span class="nx">got</span> <span class="o">!=</span> <span class="nx">want</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p><img alt="" src=".gitbook/assets/image%20%287%29.png" /></p>
<p>Testi geçirecek kadar kod yazalım.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">Hello</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;Hello, Mehmet&quot;</span>
<span class="p">}</span>
</code></pre></div>


<blockquote>
<p>Yukarıdaki örnekte amacımızın dışında bir kod yazarak testin geçmesini sağladık. Bu örnek her ne kadar abes dursada, bu tür durumlar daha büyük ölçekli işlerde başımıza gelebilir ve fark edilmediğinde anlaşılması zor buglar ortaya çıkartabilir.</p>
</blockquote>
<p>Eklediğimiz özelliğin düzgün çalıştığından emin olmak için bir test daha ekleyelim.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">TestHello</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;Mehmet&quot;</span><span class="p">)</span>
    <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Hello, Mehmet&quot;</span>

    <span class="k">if</span> <span class="nx">got</span> <span class="o">!=</span> <span class="nx">want</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">TestHelloWithAnotherName</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;Ahmet&quot;</span><span class="p">)</span>
    <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Hello, Ahmet&quot;</span>

    <span class="k">if</span> <span class="nx">got</span> <span class="o">!=</span> <span class="nx">want</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p><img alt="" src=".gitbook/assets/image%20%284%29.png" /></p>
<p>Şimdi de testi geçecek kodu yazalım.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">Hello</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="nx">name</span>
<span class="p">}</span>
</code></pre></div>


<blockquote>
<p>Bu aşamada elimizde testleri ile birlikte çalışan yeni özelliği commit edebiliriz.</p>
</blockquote>
<p>Bu aşamada, TDD yaşam döngüsü gereği kod refactor edilmeye çalışılır. "Hello, " her durumda sabit olduğu için globalde tanımlayabiliriz.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span> <span class="nx">englishHelloPrefix</span> <span class="p">=</span> <span class="s">&quot;Hello, &quot;</span>

<span class="kd">func</span> <span class="nx">Hello</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">englishHelloPrefix</span> <span class="o">+</span> <span class="nx">name</span>
<span class="p">}</span>
</code></pre></div>


<blockquote>
<p>Refactor yapıldıktan sonra mutlaka testler yeniden çalıştırılmalı ve kod davranışının değişmediğinden emin olunmalıdır.</p>
</blockquote>
<p>Şimdi uygulamamıza bir özellik daha ekleyelim. Bu kez <code>Hello</code> fonksiyonuna boş isim verilince ön tanımlı mesajla selamlasın.</p>
<p>Tabiki önce testini yazıyoruz.</p>
<p>Aynı kod parçası için yazılan testleri tek fonksiyon altında toplayabiliriz. <code>t.Run</code> yapısı sayesinde verdiğimiz farklı test mesajları ile birlikte testleri bir araya getirebiliriz. </p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">TestHello</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;Say hello to a specific name&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;Mehmet&quot;</span><span class="p">)</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Hello, Mehmet&quot;</span>

        <span class="k">if</span> <span class="nx">got</span> <span class="o">!=</span> <span class="nx">want</span> <span class="p">{</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">})</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;Say &#39;Hello, Dude&#39; when an empty string is provided&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Hello, Dude&quot;</span>

        <span class="k">if</span> <span class="nx">got</span> <span class="o">!=</span> <span class="nx">want</span> <span class="p">{</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></div>


<blockquote>
<p>Refactoring sadece <em>business logic</em> içeren kodlar için değildir. Test kodlarına da projede tıpkı diğer kodlar gibi yaklaşılmalıdır.</p>
</blockquote>
<p>Bu aşamada testlerimizde tekrar eden kısımlar için bir fonksiyon yazabiliriz.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">TestHello</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">assertCorrectMessage</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">Helper</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">got</span> <span class="o">!=</span> <span class="nx">want</span> <span class="p">{</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;Say hello to a specific name&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;Mehmet&quot;</span><span class="p">)</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Hello, Mehmet&quot;</span>
        <span class="nx">assertCorrectMessage</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;Say &#39;Hello, Dude&#39; when an empty string is provided&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Hello, Dude&quot;</span>
        <span class="nx">assertCorrectMessage</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></div>


<p>Şimdi elimizde düzgün bir şekilde yazılmış hata veren bir test var. Uygulamaya testi geçmek için yeterli kodu yazalım.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span> <span class="nx">englishHelloPrefix</span> <span class="p">=</span> <span class="s">&quot;Hello, &quot;</span>

<span class="kd">func</span> <span class="nx">Hello</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">name</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="p">=</span> <span class="s">&quot;Dude&quot;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">englishHelloPrefix</span> <span class="o">+</span> <span class="nx">name</span>
<span class="p">}</span>
</code></pre></div>


<p>Böylece uygulamamıza önceki özellikleri etkilemeden yeni bir özellik eklemiş olduk.</p>
<blockquote>
<p>Bu aşamada eski commiti amend edip, fonksiyonumuzu yeni versiyonu ile değiştirebiliriz.</p>
</blockquote>
<h3 id="gelistirme-disiplini">Geliştirme Disiplini<a class="headerlink" href="#gelistirme-disiplini" title="Permanent link">&para;</a></h3>
<ul>
<li>Yeni özelliği kullanan bir test yaz</li>
<li>Kodun derlendiğinden emin ol</li>
<li>Testi çalıştır, hatayı gözlemle</li>
<li>Testi geçirecek minimum kodu yaz</li>
<li>Refactor</li>
</ul>
<p>Bu kadar adım zahmetli ve paranoyakça gelebilir fakat her adımda kodun durumunu kontrol etmek oldukça önemlidir.</p>
<p>Bu disipline sadık kalarak sadece amacına uygun testler yazmakla kalmayız aynı zamanda otomatikleştirilmiş testlerle sürekli düzenlenen ve iyi şekilde tasarlanan bir yazılım geliştirmiş oluruz.</p>
<p>Testlerin ne için yazıldığını anlaşılır bir şekilde hata mesajında göstermek çok önemlidir. Yazılımcının, testin neden hata verdiğini anlayamaması problemi çözmeyi zorlaştıracaktır.</p>
<p>Testlerin hızlı çalışması ve kolay bir şekilde çalıştırılabilmesi gerekir. Bu akıcı bir şekilde kod yazmamızı sağlayacaktır.</p>
<p>Testsiz kod yazarak, uygulamanın akışını ve olası her durumunu kontrol etme işini kendinize yüklemiş olursunuz. Bu da uzun dönemde ciddi vakit kaybına yol açacaktır.</p>
<h3 id="daha-fazla-ozellik">Daha fazla özellik<a class="headerlink" href="#daha-fazla-ozellik" title="Permanent link">&para;</a></h3>
<p>Yeni isteğe göre uygulamamıza dil desteği ekleyeceğiz. Eğer dil sistemimiz tarafından destekleniyorsa selamlama mesajı verilen dilde sağlanacak. Desteklenmiyorsa ön tanımlı olan İngilizce mesaj gönderilecek.</p>
<p>Başlangıç olarak Fransızca dil desteği için test yazalım.</p>
<div class="codehilite"><pre><span></span><code><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;in French&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;Lara Fabian&quot;</span><span class="p">,</span> <span class="s">&quot;French&quot;</span><span class="p">)</span>
    <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Bonjour, Lara Fabian&quot;</span>
    <span class="nx">assertCorrectMessage</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>


<blockquote>
<p>Bu haliyle <code>Hello</code> tek parametre aldığı için compiler hata verecektir. Bu adımda, hile yapıp doğrudan kodu yazmaktan kaçınmalıyız.</p>
</blockquote>
<p>Fonksiyona gerekli olan 2. parametreyi ekleyelim.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">Hello</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">language</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">name</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="p">=</span> <span class="s">&quot;Dude&quot;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">englishHelloPrefix</span> <span class="o">+</span> <span class="nx">name</span>
<span class="p">}</span>
</code></pre></div>


<p>Testleri çalıştırdığımızda, yeni özelliğe göre tasarlanmadığı için eski testler hata verecektir. Eski testlere parametre olarak boş string vererek compiler hatasından kurtulalım. Bu durumda, sadece yeni eklediğimiz testin fail olması gerekir.</p>
<p>Şimdi response bodyi  </p>
<p><img alt="" src=".gitbook/assets/image%20%286%29.png" /></p>
<p>Yeni bir <code>if</code> ekleyerek Fransızca için yazdığımız testi geçebiliriz.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">Hello</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">language</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">name</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="p">=</span> <span class="s">&quot;Dude&quot;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">language</span> <span class="o">==</span> <span class="s">&quot;French&quot;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;Bonjour, &quot;</span> <span class="o">+</span> <span class="nx">name</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">englishHelloPrefix</span> <span class="o">+</span> <span class="nx">name</span>
<span class="p">}</span>
</code></pre></div>


<p>Bu haliyle bütün testleri başarılı olması gerekiyor.</p>
<p>Şimdi kodumuzu <em>refactor</em>  edebiliriz. İşe, kod içinde tanımlı stringlerden başlayabiliriz. <br />
<em>Yapılan her değişiklikte testlerin başarılı olduğunu kontrol etmeliyiz.</em></p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span> <span class="nx">french</span> <span class="p">=</span> <span class="s">&quot;French&quot;</span>
<span class="kd">const</span> <span class="nx">englishHelloPrefix</span> <span class="p">=</span> <span class="s">&quot;Hello, &quot;</span>
<span class="kd">const</span> <span class="nx">frenchHelloPrefix</span> <span class="p">=</span> <span class="s">&quot;Bonjour, &quot;</span>

<span class="kd">func</span> <span class="nx">Hello</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">language</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">name</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="p">=</span> <span class="s">&quot;Dude&quot;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">language</span> <span class="o">==</span> <span class="nx">french</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">frenchHelloPrefix</span> <span class="o">+</span> <span class="nx">name</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">englishHelloPrefix</span> <span class="o">+</span> <span class="nx">name</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="yeni-dil">Yeni dil<a class="headerlink" href="#yeni-dil" title="Permanent link">&para;</a></h4>
<p>Şimdi Koreceye de destek verelim. Bunun için daha önce yaptığımız gibi:</p>
<ul>
<li>Korean yazdığımızda 안녕 ile başlayan bir mesaj bekleyen test yazacağız</li>
<li>Testi çalıştırıp hata alacağız ve hata mesajının düzgün olduğuna dikkat edeceğiz</li>
<li>Kod üzerinde testi geçecek minimum değişikliği yapacağız</li>
</ul>
<p>Değişikliklerden sonra elimizde aşağı yukarı böyle bir kod olacak:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">TestHello</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">assertCorrectMessage</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">Helper</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">got</span> <span class="o">!=</span> <span class="nx">want</span> <span class="p">{</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;Say hello to a specific name&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;Mehmet&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Hello, Mehmet&quot;</span>
        <span class="nx">assertCorrectMessage</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;Say &#39;Hello, Dude&#39; when an empty string is provided&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Hello, Dude&quot;</span>
        <span class="nx">assertCorrectMessage</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;in French&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;Lara Fabian&quot;</span><span class="p">,</span> <span class="s">&quot;French&quot;</span><span class="p">)</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;Bonjour, Lara Fabian&quot;</span>
        <span class="nx">assertCorrectMessage</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;in Korean&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">got</span> <span class="o">:=</span> <span class="nx">Hello</span><span class="p">(</span><span class="s">&quot;세상&quot;</span><span class="p">,</span> <span class="s">&quot;Korean&quot;</span><span class="p">)</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="s">&quot;안녕 세상&quot;</span>
        <span class="nx">assertCorrectMessage</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="kd">const</span> <span class="nx">french</span> <span class="p">=</span> <span class="s">&quot;French&quot;</span>
<span class="kd">const</span> <span class="nx">korean</span> <span class="p">=</span> <span class="s">&quot;Korean&quot;</span>

<span class="kd">const</span> <span class="nx">englishHelloPrefix</span> <span class="p">=</span> <span class="s">&quot;Hello, &quot;</span>
<span class="kd">const</span> <span class="nx">frenchHelloPrefix</span> <span class="p">=</span> <span class="s">&quot;Bonjour, &quot;</span>
<span class="kd">const</span> <span class="nx">koreanHelloPrefix</span> <span class="p">=</span> <span class="s">&quot;안녕 &quot;</span>

<span class="kd">func</span> <span class="nx">Hello</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">language</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">name</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="p">=</span> <span class="s">&quot;Dude&quot;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">language</span> <span class="o">==</span> <span class="nx">french</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">frenchHelloPrefix</span> <span class="o">+</span> <span class="nx">name</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">language</span> <span class="o">==</span> <span class="nx">korean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">koreanHelloPrefix</span> <span class="o">+</span> <span class="nx">name</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">englishHelloPrefix</span> <span class="o">+</span> <span class="nx">name</span>
<span class="p">}</span>
</code></pre></div>


<p>Yeni özelliğimizi, çalışan testi ile eklediğimize göre şimdi kodumuzu refactor edebiliriz.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">Hello</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">language</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">name</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="p">=</span> <span class="s">&quot;Dude&quot;</span>
    <span class="p">}</span>

    <span class="nx">prefix</span> <span class="o">:=</span> <span class="nx">englishHelloPrefix</span>

    <span class="k">switch</span> <span class="nx">language</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">french</span><span class="p">:</span>
        <span class="nx">prefix</span> <span class="p">=</span> <span class="nx">frenchHelloPrefix</span>
    <span class="k">case</span> <span class="nx">korean</span><span class="p">:</span>
        <span class="nx">prefix</span> <span class="p">=</span> <span class="nx">koreanHelloPrefix</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="nx">name</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="real-world-example">Real World Example<a class="headerlink" href="#real-world-example" title="Permanent link">&para;</a></h2>
<p>Gerçek bir uygulamaya testlerin nasıl yazıldığını incelemek için https://randomuser.me/api/ APIsinden kullanıcıları çeken bir HTTP Client yazalım. UserClient yapısı ile, verilerin çekileceği URLi, kaç sayfa veri çekeceğini ve her sayfada ne kadar veri alacağı  ve de HTTP isteklerinin atılacağı kütüphane belirliyoruz.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">type</span> <span class="nx">UserClient</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">BaseUrl</span>                  <span class="kt">string</span>
    <span class="nx">TaskCount</span><span class="p">,</span> <span class="nx">ResultPerPage</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="nx">uc</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">UserClient</span><span class="p">{</span>
    <span class="nx">BaseUrl</span><span class="p">:</span>       <span class="s">&quot;https://randomuser.me/api/&quot;</span><span class="p">,</span>
    <span class="nx">TaskCount</span><span class="p">:</span>     <span class="mi">20</span><span class="p">,</span>
    <span class="nx">ResultPerPage</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="nx">requester</span><span class="p">:</span>     <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{},</span>
<span class="p">}</span>

<span class="nx">user</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">uc</span><span class="p">.</span><span class="nx">Get</span><span class="p">()</span>
<span class="nx">users</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">uc</span><span class="p">.</span><span class="nx">FetchAll</span><span class="p">()</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">res</span><span class="p">))</span> <span class="c1">// 2000</span>
</code></pre></div>


<h3 id="mocking">Mocking<a class="headerlink" href="#mocking" title="Permanent link">&para;</a></h3>
<p>Unit testlerin çalıştığı ortamdan, dış kaynaklardan ve kütüphanelerden bağımsız olması gerekir. Bu yüzden <code>http.Client</code> aynı davranışı sergileyen fakat sahte veri dönen başka bir modül ile değiştirilmeli.</p>
<p>Ortak davranışlara sahip modüller geliştirmenin en kolay yolu ortak interface kullanmak. http.Clientin kullanacağımız methodlarına sahip Requester adında bir interface tanımlayalım. </p>
<div class="codehilite"><pre><span></span><code><span class="kd">type</span> <span class="nx">Requester</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nx">Get</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">UserClient</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">BaseUrl</span>                  <span class="kt">string</span>
    <span class="nx">TaskCount</span><span class="p">,</span> <span class="nx">ResultPerPage</span> <span class="kt">int</span>

    <span class="nx">requester</span> <span class="nx">Requester</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">UserClient</span><span class="p">)</span> <span class="nx">Get</span><span class="p">()</span> <span class="p">(</span><span class="nx">response</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">UserClient</span><span class="p">)</span> <span class="nx">FetchAll</span><span class="p">()</span> <span class="p">(</span><span class="nx">result</span> <span class="p">[]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre></div>


<p>Testleri çalıştırırken kullanacağımız, http.Client gibi Requesteri implement eden sahte bir client oluşturalım ve FakeClientı kullanarak UserClient için bir test yazalım.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">type</span> <span class="nx">FakeClient</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Body</span>  <span class="p">[]</span><span class="kt">byte</span>
    <span class="nx">Error</span> <span class="kt">error</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">FakeClient</span><span class="p">)</span> <span class="nx">Get</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">resp</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">{</span>
        <span class="nx">Body</span><span class="p">:</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">NopCloser</span><span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewBuffer</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Body</span><span class="p">)),</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">resp</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Error</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">TestGetUser</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">userclient</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">UserClient</span><span class="p">{}</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;get userclient returns err on bad response&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">userclient</span><span class="p">.</span><span class="nx">requester</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{</span>
            <span class="nx">Error</span><span class="p">:</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;Bad Request&quot;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">userclient</span><span class="p">.</span><span class="nx">Get</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Expected to get an error&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">})</span>

<span class="p">}</span>
</code></pre></div>


<p>http.Clienti, sahtesi ile aşağıdaki şekilde değiştirdik.</p>
<div class="codehilite"><pre><span></span><code><span class="nx">userclient</span><span class="p">.</span><span class="nx">requester</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{</span>
    <span class="nx">Body</span><span class="p">:</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;status&quot;: &quot;ok&quot;}`</span><span class="p">),</span>
<span class="p">}</span>
</code></pre></div>


<p>FakeClient aldığı Body verisini Get methodu çalıştırıldığında bize http.Clientinkine benzer şekilde dönecek.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">FakeClient</span><span class="p">)</span> <span class="nx">Get</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">resp</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">{</span>
        <span class="nx">Body</span><span class="p">:</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">NopCloser</span><span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewBuffer</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Body</span><span class="p">)),</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">resp</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Error</span>
<span class="p">}</span>
</code></pre></div>


<p>Artık elimizde fail olan bir test var. Bu testi geçecek kodu yazabiliriz.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">UserClient</span><span class="p">)</span> <span class="nx">Get</span><span class="p">()</span> <span class="p">(</span><span class="nx">response</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">erros</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;Error&quot;</span><span class="p">)</span>
    <span class="k">return</span>
<span class="p">}</span>
</code></pre></div>


<p>Şimdi de response bodyi kontrol eden bir test yazalım.</p>
<div class="codehilite"><pre><span></span><code><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;get userclient returns err if response body invalid&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">userclient</span><span class="p">.</span><span class="nx">requester</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{}</span>

    <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">userclient</span><span class="p">.</span><span class="nx">Get</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Expected to get an error&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div>


<p>Artık testi geçmek için kod yazabiliriz.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">UserClient</span><span class="p">)</span> <span class="nx">Get</span><span class="p">()</span> <span class="p">(</span><span class="nx">response</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">url</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s?results=%d&quot;</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">BaseUrl</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ResultPerPage</span><span class="p">)</span>

    <span class="nx">res</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">requester</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>Son olarak başarılı response durumunu test edelim.</p>
<div class="codehilite"><pre><span></span><code><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;get userclient returns unmarshalled response body on success&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">userclient</span><span class="p">.</span><span class="nx">requester</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{</span>
        <span class="nx">Body</span><span class="p">:</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;status&quot;: &quot;ok&quot;}`</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="nx">got</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">userclient</span><span class="p">.</span><span class="nx">Get</span><span class="p">()</span>
    <span class="nx">want</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
        <span class="s">&quot;status&quot;</span><span class="p">:</span> <span class="s">&quot;ok&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div>


<p>Artık byte JSONu düzgünce <em>parse</em> eden bir kod yazmamız gerekiyor.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">UserClient</span><span class="p">)</span> <span class="nx">Get</span><span class="p">()</span> <span class="p">(</span><span class="nx">response</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">url</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s?results=%d&quot;</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">BaseUrl</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ResultPerPage</span><span class="p">)</span>

    <span class="nx">res</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">requester</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">res</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">)</span>
    <span class="nx">buf</span><span class="p">.</span><span class="nx">ReadFrom</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
    <span class="nx">newStr</span> <span class="o">:=</span> <span class="nx">buf</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
    <span class="nx">err</span> <span class="p">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">newStr</span><span class="p">),</span> <span class="o">&amp;</span><span class="nx">data</span><span class="p">)</span>
    <span class="nx">response</span> <span class="p">=</span> <span class="nx">data</span>
    <span class="k">return</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="table-test">Table Test<a class="headerlink" href="#table-test" title="Permanent link">&para;</a></h3>
<p>Kod tekrarını azaltmak için <em>table driven test</em>  yöntemini kullanabiliriz.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">TestFetchAll</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">testCases</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">name</span>     <span class="kt">string</span>
        <span class="nx">client</span>   <span class="o">*</span><span class="nx">UserClient</span>
        <span class="nx">expected</span> <span class="p">[]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
    <span class="p">}{</span>
        <span class="p">{</span>
            <span class="s">&quot;get userclient returns err on bad response&quot;</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="nx">UserClient</span><span class="p">{</span>
                <span class="nx">ResultPerPage</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nx">TaskCount</span><span class="p">:</span>     <span class="mi">0</span><span class="p">,</span>
                <span class="nx">requester</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{</span>
                    <span class="nx">Body</span><span class="p">:</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;results&quot;: [{&quot;test&quot;: &quot;ok&quot;}]`</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="p">[]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{},</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s">&quot;get userclient returns err if response body invalid&quot;</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="nx">UserClient</span><span class="p">{</span>
                <span class="nx">ResultPerPage</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nx">TaskCount</span><span class="p">:</span>     <span class="mi">1</span><span class="p">,</span>
                <span class="nx">requester</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{</span>
                    <span class="nx">Body</span><span class="p">:</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;results&quot;: [{&quot;test&quot;: &quot;ok&quot;}]`</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">},</span> <span class="p">[]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{},</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s">&quot;get userclient returns unmarshalled response body on success&quot;</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="nx">UserClient</span><span class="p">{</span>
                <span class="nx">ResultPerPage</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nx">TaskCount</span><span class="p">:</span>     <span class="mi">1</span><span class="p">,</span>
                <span class="nx">requester</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{</span>
                    <span class="nx">Body</span><span class="p">:</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;results&quot;: [{&quot;test&quot;: &quot;ok&quot;}]`</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">},</span> <span class="p">[]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{},</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">testCases</span> <span class="p">{</span>
        <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">got</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">FetchAll</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">expected</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">tt</span><span class="p">.</span><span class="nx">expected</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="anti-patternler">Anti-Patternler<a class="headerlink" href="#anti-patternler" title="Permanent link">&para;</a></h2>
<p><strong>İkinci Sınıf Vatandaşlık<br />
D</strong>iğer kodları yazarken uyguladığımız yazılım prensipleri test kodları için de geçerli.<br />
<strong>Obsessive Coverage</strong><br />
Test coverageın yüksek olması, projenin bütün durumlarının test edildiğini göstermez. Bir projenin düzgün test edildiğinin göstergesi sadece coverage raporları değildir.<br />
<strong>Structural Inspection</strong><br />
Projede structların, ve diğer veri yapılarının aldıkları değerleri değil methodları ve fonksiyonların davranışlarını test etmeliyiz.<br />
<strong>God Object</strong><br />
Test edilmesi zor, büyük yapılar parçalanmalıdır. Eğer test ettiğimiz kod çok fazla mock kullandırıyorsa bu God Objectin belirtisi olabilir.<br />
<strong>Mockery</strong><br />
Testlerde aşırı mock kullanımı, uygulama davranışını değil mockerların değerlerini test etmemizle sonuçlanır.<br />
<strong>Instance Reuse</strong><br />
Test edilen yapılar, çalıştırılan her test için yeniden üretilmelidir.<br />
<strong>Local Hero</strong><br />
Testler çalıştığı ortamdan ve makineden bağımsız olmalıdır.<br />
<strong>Happy Path Testing</strong><br />
Uygulamada sadece başarılı sonuçları değil, olası bütün durumları test etmeliyiz.<br />
<strong>Kötü İsimlendirme (Sıralı İsimlendirme)</strong><br />
Testlerin isimleri ve mesajları açıklayıcı ve ayırt edici olmalıdır.<br />
<strong>Yeni Test Yerine Assertion Ekleme</strong><br />
Birime yeni özellik eklendiğinde, veya bir kısmı değiştirildiğinde var olan bir teste ekstra bir kontrol eklenmemelidir. Sadece bu durumu yeni bir test yazılmalıdır.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bytes&quot;</span>
    <span class="s">&quot;encoding/json&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Requester</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nx">Get</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">UserClient</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">BaseUrl</span>                  <span class="kt">string</span>
    <span class="nx">TaskCount</span><span class="p">,</span> <span class="nx">ResultPerPage</span> <span class="kt">int</span>

    <span class="nx">requester</span> <span class="nx">Requester</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">UserClient</span><span class="p">)</span> <span class="nx">Get</span><span class="p">()</span> <span class="p">(</span><span class="nx">response</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">url</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s?results=%d&quot;</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">BaseUrl</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ResultPerPage</span><span class="p">)</span>

    <span class="nx">res</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">requester</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">res</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">)</span>
    <span class="nx">buf</span><span class="p">.</span><span class="nx">ReadFrom</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
    <span class="nx">newStr</span> <span class="o">:=</span> <span class="nx">buf</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
    <span class="nx">err</span> <span class="p">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">newStr</span><span class="p">),</span> <span class="o">&amp;</span><span class="nx">data</span><span class="p">)</span>
    <span class="nx">response</span> <span class="p">=</span> <span class="nx">data</span>
    <span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><span class="nx">UserClient</span><span class="p">)</span> <span class="nx">FetchAll</span><span class="p">()</span> <span class="p">(</span><span class="nx">result</span> <span class="p">[]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ch1</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nx">expectedCount</span> <span class="o">:=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">TaskCount</span> <span class="o">*</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ResultPerPage</span>
    <span class="nx">result</span> <span class="p">=</span> <span class="p">[]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{}</span>

    <span class="k">if</span> <span class="nx">d</span><span class="p">.</span><span class="nx">TaskCount</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ResultPerPage</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">TaskCount</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ch</span> <span class="kd">chan</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
            <span class="nx">response</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">Get</span><span class="p">()</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="k">for</span> <span class="nx">j</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="p">&lt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ResultPerPage</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">{</span>
                    <span class="nx">ch</span> <span class="o">&lt;-</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{}</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">data</span> <span class="o">:=</span> <span class="nx">response</span><span class="p">[</span><span class="s">&quot;results&quot;</span><span class="p">].([]</span><span class="kd">interface</span><span class="p">{})</span>
                <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">datum</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">data</span> <span class="p">{</span>
                    <span class="nx">ch</span> <span class="o">&lt;-</span> <span class="nx">datum</span><span class="p">.(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="p">}(</span><span class="nx">ch1</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nx">data</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">ch1</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="o">==</span> <span class="nx">expectedCount</span> <span class="p">{</span>
            <span class="nb">close</span><span class="p">(</span><span class="nx">ch1</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">uc</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">UserClient</span><span class="p">{</span>
        <span class="nx">BaseUrl</span><span class="p">:</span>       <span class="s">&quot;https://randomuser.me/api/&quot;</span><span class="p">,</span>
        <span class="nx">TaskCount</span><span class="p">:</span>     <span class="mi">20</span><span class="p">,</span>
        <span class="nx">ResultPerPage</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="nx">requester</span><span class="p">:</span>     <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{},</span>
    <span class="p">}</span>
    <span class="nx">res</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">uc</span><span class="p">.</span><span class="nx">FetchAll</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">res</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bytes&quot;</span>
    <span class="s">&quot;errors&quot;</span>
    <span class="s">&quot;io/ioutil&quot;</span>
    <span class="s">&quot;net/http&quot;</span>
    <span class="s">&quot;reflect&quot;</span>
    <span class="s">&quot;testing&quot;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">FakeClient</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Body</span>  <span class="p">[]</span><span class="kt">byte</span>
    <span class="nx">Error</span> <span class="kt">error</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">FakeClient</span><span class="p">)</span> <span class="nx">Get</span><span class="p">(</span><span class="nx">url</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">resp</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">resp</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">{</span>
        <span class="nx">Body</span><span class="p">:</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">NopCloser</span><span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewBuffer</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Body</span><span class="p">)),</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">resp</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Error</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">TestGetUser</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">userclient</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">UserClient</span><span class="p">{}</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;get userclient returns err on bad response&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">userclient</span><span class="p">.</span><span class="nx">requester</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{</span>
            <span class="nx">Error</span><span class="p">:</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;Bad Request&quot;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">userclient</span><span class="p">.</span><span class="nx">Get</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Expected to get an error&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">})</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;get userclient returns err if response body invalid&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">userclient</span><span class="p">.</span><span class="nx">requester</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{}</span>

        <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">userclient</span><span class="p">.</span><span class="nx">Get</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Expected to get an error&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">})</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;get userclient returns unmarshalled response body on success&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">userclient</span><span class="p">.</span><span class="nx">requester</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{</span>
            <span class="nx">Body</span><span class="p">:</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;status&quot;: &quot;ok&quot;}`</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="nx">got</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">userclient</span><span class="p">.</span><span class="nx">Get</span><span class="p">()</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
            <span class="s">&quot;status&quot;</span><span class="p">:</span> <span class="s">&quot;ok&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">TestFetchAll</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;fetchall returns empty list if task count is 0&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">userclient</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">UserClient</span><span class="p">{</span>
            <span class="nx">ResultPerPage</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">TaskCount</span><span class="p">:</span>     <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nx">userclient</span><span class="p">.</span><span class="nx">requester</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{</span>
            <span class="nx">Body</span><span class="p">:</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;results&quot;: [{&quot;test&quot;: &quot;ok&quot;}]`</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="nx">got</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">userclient</span><span class="p">.</span><span class="nx">FetchAll</span><span class="p">()</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{}</span>
        <span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="p">})</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;fetchall returns empty list if per page is 0&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">userclient</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">UserClient</span><span class="p">{</span>
            <span class="nx">ResultPerPage</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">TaskCount</span><span class="p">:</span>     <span class="mi">1</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nx">userclient</span><span class="p">.</span><span class="nx">requester</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{</span>
            <span class="nx">Body</span><span class="p">:</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;results&quot;: [{&quot;test&quot;: &quot;ok&quot;}]`</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="nx">got</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">userclient</span><span class="p">.</span><span class="nx">FetchAll</span><span class="p">()</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{}</span>
        <span class="k">if</span> <span class="p">!</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">DeepEqual</span><span class="p">(</span><span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %q want %q&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="p">})</span>

    <span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;fetchall returns the same amount of records with item count&quot;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">userclient</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">UserClient</span><span class="p">{</span>
            <span class="nx">TaskCount</span><span class="p">:</span>     <span class="mi">5</span><span class="p">,</span>
            <span class="nx">ResultPerPage</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nx">userclient</span><span class="p">.</span><span class="nx">requester</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">FakeClient</span><span class="p">{</span>
            <span class="nx">Body</span><span class="p">:</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;results&quot;: [{&quot;test&quot;: &quot;ok&quot;}]`</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="nx">res</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">userclient</span><span class="p">.</span><span class="nx">FetchAll</span><span class="p">()</span>
        <span class="nx">got</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
        <span class="nx">want</span> <span class="o">:=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="nx">got</span> <span class="o">!=</span> <span class="nx">want</span> <span class="p">{</span>
            <span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;got %d want %d&quot;</span><span class="p">,</span> <span class="nx">got</span><span class="p">,</span> <span class="nx">want</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="p">})</span>

<span class="p">}</span>
</code></pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="https://github.com/mgurdal" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
      
      
      <a href="https://twitter.com/mgurdal_" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
      <a href="https://linkedin.com/in/mgurdal" target="_blank" rel="noopener" title="linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.f45d2d8d.min.js"></script>
      <script src="../../assets/javascripts/bundle.74d0b805.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>